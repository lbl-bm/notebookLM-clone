# NotebookLM Clone é¡¹ç›®è®¡åˆ’ä¹¦

> **ç‰ˆæœ¬**: v1.0  
> **æ—¥æœŸ**: 2026å¹´1æœˆ  
> **ç¼–åˆ¶äºº**: AI æŠ€æœ¯å›¢é˜Ÿ  
> **é¡¹ç›®ç±»å‹**: ä¸ªäºº/å›¢é˜ŸçŸ¥è¯†åº“ç®¡ç†åŸå‹äº§å“

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

åœ¨æ¢ç´¢ AI Agent/Workflow ä¸å‰ç«¯å·¥ç¨‹é›†æˆçš„è¿‡ç¨‹ä¸­,æˆ‘ä»¬é€‰æ‹©"ä¸ªäºº/å›¢é˜ŸçŸ¥è¯†åº“"ä½œä¸ºå¯æ¼”ç¤ºä¸”å¯æ·±åº¦äº¤äº’çš„æ•°æ®æºä¸åº”ç”¨åœºæ™¯ã€‚å½“å‰å¸‚åœºä¸Šè™½ç„¶æœ‰ Google NotebookLM ç­‰ç±»ä¼¼äº§å“,ä½†åœ¨å¯æ‰©å±•æ€§ã€Agent å·¥ä½œæµé›†æˆã€æ£€ç´¢é“¾è·¯å¯è§†åŒ–ç­‰æ–¹é¢ä»å­˜åœ¨æ”¹è¿›ç©ºé—´ã€‚

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€ä¸ªå¯è¿è¡Œã€å¯å±•ç¤ºã€å¯æ‰©å±•çš„ AI åº”ç”¨åŸå‹,ä¸ºä¸ªäººä¸å›¢é˜Ÿæä¾›å¯è¿½æº¯ã€å¯éªŒè¯ã€å¯ç”Ÿæˆçš„çŸ¥è¯†åº“ç®¡ç†æ–¹æ¡ˆã€‚

### 1.2 é¡¹ç›®ç›®çš„

**æ ¸å¿ƒç›®æ ‡**:
1. **çŸ¥è¯†ç®¡ç†é—­ç¯**: å®ç°"çŸ¥è¯†å¯¼å…¥ â†’ å‘é‡åŒ– â†’ RAG å¯¹è¯ â†’ ç»“æ„åŒ–äº§ç‰©ç”Ÿæˆ"çš„å®Œæ•´é—­ç¯
2. **å¯è¿½æº¯æ€§ä¿éšœ**: æ¯æ¡ AI å›ç­”å¿…é¡»é™„å¸¦å¯æº¯æºçš„å¼•ç”¨,æ”¯æŒæŸ¥çœ‹æ£€ç´¢é“¾è·¯è¯¦æƒ…
3. **æ™ºèƒ½äº¤äº’ä½“éªŒ**: åŸºäºè¯æ®çš„å¯¹è¯ä½“éªŒ,é™ä½å¹»è§‰,æé«˜å¯ä¿¡åº¦
4. **å¯æ‰©å±•æ¶æ„**: æ„å»º Agent/Workflow å¯æ‰©å±•åº•åº§,ä¸ºåç»­æ¼”è¿›é¢„ç•™ç©ºé—´

**åº”ç”¨åœºæ™¯**:
- **å­¦ç”Ÿç”¨æˆ·**: æ•´ç†è¯¾å ‚è®²ä¹‰ã€è®ºæ–‡ã€ç½‘è¯¾èµ„æ–™,å¿«é€Ÿé—®ç­”å·©å›ºçŸ¥è¯†ç‚¹
- **ç ”ç©¶äººå‘˜**: èšåˆæ–‡çŒ®ã€æŠ¥å‘Šã€å®éªŒè®°å½•,è¿›è¡Œè·¨æ–‡æ¡£æ£€ç´¢ä¸é—®ç­”
- **ä¼ä¸šå›¢é˜Ÿ**: æ²‰æ·€é¡¹ç›®æ–‡æ¡£ã€FAQã€åŸ¹è®­ææ–™,æ”¯æŒå›¢é˜Ÿåä½œä¸çŸ¥è¯†ä¼ æ‰¿

### 1.3 åˆ›æ–°ç‚¹ä¸å·®å¼‚åŒ–ä¼˜åŠ¿

ä¸ Google NotebookLM ç­‰ç°æœ‰æ–¹æ¡ˆç›¸æ¯”,æœ¬é¡¹ç›®çš„å·®å¼‚åŒ–ä¼˜åŠ¿åŒ…æ‹¬:

#### 1) Agent/Workflow å¯æ‰©å±•åº•åº§
- **ç°çŠ¶**: ä¼ ç»Ÿäº§å“èƒ½åŠ›å›ºåŒ–åœ¨å‡ ä¸ªé¢„è®¾æŒ‰é’®
- **åˆ›æ–°**: åŠ¨ä½œé€šè¿‡ç»Ÿä¸€çš„ Action API æ‰§è¡Œ,å¯å¹³æ»‘æ‰©å±•ä¸ºå¯è§†åŒ– Workflow ç¼–æ’
- **ä»·å€¼**: é™ä½åŠŸèƒ½è¿­ä»£æˆæœ¬,æå‡ç³»ç»Ÿæ‰©å±•æ€§

#### 2) RAG é“¾è·¯å¯è§†åŒ–
- **ç°çŠ¶**: ç”¨æˆ·åªèƒ½çœ‹åˆ°æœ€ç»ˆç­”æ¡ˆå’Œå¼•ç”¨é«˜äº®
- **åˆ›æ–°**: å±•ç¤º"ç”¨æˆ·é—®é¢˜ â†’ æ£€ç´¢åˆ°çš„ chunks(å«ç›¸ä¼¼åº¦) â†’ æœ€ç»ˆå›ç­”"çš„å®Œæ•´é“¾è·¯
- **ä»·å€¼**: è®©"å¯è¿½æº¯æ€§"ä»å¼•ç”¨é«˜äº®å‡çº§ä¸º"å¯è§£é‡Šçš„æ£€ç´¢è¿‡ç¨‹"

#### 3) ä¸¥æ ¼çš„çŸ¥è¯†åº“çº¦æŸç­–ç•¥
- **ç°çŠ¶**: éƒ¨åˆ†äº§å“å¯èƒ½äº§ç”Ÿå¹»è§‰æˆ–è¶…å‡ºçŸ¥è¯†åº“èŒƒå›´çš„å›ç­”
- **åˆ›æ–°**: æ”¯æŒ"æ‰¾ä¸åˆ°ä¾æ®åˆ™æ‹’ç­”/æç¤ºè¡¥å……èµ„æ–™"æœºåˆ¶
- **ä»·å€¼**: å¯¹ ToB æ¼”ç¤ºå’Œä¼ä¸šåœºæ™¯å°¤å…¶é‡è¦,æé«˜å¯ä¿¡åº¦

#### 4) å¤šæ¨¡æ€è¾“å…¥ä¸çµæ´»åˆ‡åˆ†
- **ç°çŠ¶**: å•ä¸€æ–‡æ¡£æ ¼å¼æ”¯æŒ,å›ºå®šåˆ‡åˆ†ç­–ç•¥
- **åˆ›æ–°**: æ”¯æŒ PDF/Word/ç½‘é¡µé“¾æ¥ç­‰å¤šç§è¾“å…¥,æœªæ¥å¯æ‰©å±•è§†é¢‘å­—å¹•ã€å›¾ç‰‡ OCR
- **ä»·å€¼**: è¦†ç›–æ›´å¹¿æ³›çš„çŸ¥è¯†æºç±»å‹

---

## äºŒã€æŠ€æœ¯æ–¹æ¡ˆ

### 2.1 æ€»ä½“æ¶æ„

æœ¬é¡¹ç›®é‡‡ç”¨"å‰ç«¯é¡µé¢ + API è·¯ç”± + ä¸šåŠ¡æ¨¡å— + æ•°æ®å±‚ + AI é›†æˆ"çš„åˆ†å±‚æ¶æ„:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å±•ç¤ºå±‚(UI å±‚)                           â”‚
â”‚  Next.js 14 App Router + React 18 + TypeScript               â”‚
â”‚  é¡µé¢: Notebooks / Sources / Chat / Studio                   â”‚
â”‚  ç»„ä»¶: shadcn/ui + Radix UI + Tailwind CSS                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨é€»è¾‘å±‚(API å±‚)                          â”‚
â”‚  Next.js API Routes + Middleware(è·¯ç”±ä¿æŠ¤/ä¼šè¯)               â”‚
â”‚  æ¥å£: Chat / Sources / Studio / Notebooks                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡æœåŠ¡å±‚(Lib å±‚)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Processing   â”‚ RAG æ£€ç´¢     â”‚ Studio ç”Ÿæˆ  â”‚  é…ç½®ä¸­å¿ƒ â”‚  â”‚
â”‚  â”‚ è§£æ/åˆ‡åˆ†/   â”‚ æ£€ç´¢/æç¤º/   â”‚ äº§ç‰©ç”Ÿæˆ/    â”‚  ç¯å¢ƒæ ¡éªŒ â”‚  â”‚
â”‚  â”‚ åµŒå…¥/é˜Ÿåˆ—    â”‚ å¼•ç”¨æ„å»º     â”‚ æ¨¡æ¿è§£æ     â”‚  æ¨¡å‹é…ç½® â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®æŒä¹…å±‚(DB å±¥çº¦å±‚)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Supabase           â”‚ Prisma ORM        â”‚ pgvector     â”‚  â”‚
â”‚  â”‚ Auth / Storage /   â”‚ ä¸šåŠ¡è¡¨ç®¡ç†        â”‚ å‘é‡æ£€ç´¢     â”‚  â”‚
â”‚  â”‚ Postgres           â”‚                   â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI æ¨¡å‹æœåŠ¡å±‚                             â”‚
â”‚  æ™ºè°± AI: Embedding-3(1024ç»´) + GLM-4.7(å¯¹è¯/ç”Ÿæˆ)            â”‚
â”‚  LongCat: Studio æ¨¡å¼ä¸“ç”¨æ¨ç†æ¨¡å‹                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åŠŸèƒ½æ¨¡å—æ¦‚è¿°

#### 2.2.1 Notebook çŸ¥è¯†åº“ç®¡ç†
**åŠŸèƒ½æè¿°**: ç”¨æˆ·å›´ç»•ä¸€ç»„é€‰å®šèµ„æ–™åˆ›å»ºä¸“å±å¯¹è¯ç©ºé—´,å®ç°çŸ¥è¯†çš„ç»“æ„åŒ–ç»„ç»‡ä¸ç®¡ç†ã€‚

**æ ¸å¿ƒèƒ½åŠ›**:
- Notebook åˆ›å»º/åˆ é™¤/é‡å‘½å
- æœ€è¿‘æ‰“å¼€è®°å½•ä¸æ’åº
- å¤š Notebook éš”ç¦»(æŒ‰ owner_id)

#### 2.2.2 Sources çŸ¥è¯†æºå¯¼å…¥ç³»ç»Ÿ
**åŠŸèƒ½æè¿°**: æ”¯æŒå¤šç§å†…å®¹æºçš„å¯¼å…¥ä¸å¤„ç†,åŒ…æ‹¬æ–‡æœ¬ã€URLã€PDF ç­‰ã€‚

**å¤„ç†æµç¨‹**:
```
å¯¼å…¥Source â†’ æ–‡æœ¬è§£æ â†’ Chunkåˆ‡åˆ† â†’ ç”Ÿæˆå‘é‡ â†’ æ‰¹é‡å…¥åº“ â†’ ReadyçŠ¶æ€
    â†“           â†“          â†“          â†“          â†“         â†“
 Upload API  PDF/Web   Splitter   Embedding  pgvector  Status Update
```

**æ”¯æŒæ ¼å¼**:
- æ–‡ä»¶ä¸Šä¼ : PDF(å¿…é¡»)ã€Word/docx(å¯é€‰)
- é“¾æ¥æŠ“å–: ç½‘é¡µ URLã€è§†é¢‘é“¾æ¥(å­—å¹•)
- æ–‡æœ¬ç²˜è´´: ç›´æ¥è¾“å…¥æ–‡æœ¬å†…å®¹

**å¤„ç†é˜Ÿåˆ—**:
- é‡‡ç”¨å¼‚æ­¥å¤„ç†æœºåˆ¶,é¿å… API è¶…æ—¶
- æ”¯æŒæ–­ç‚¹ç»­ä¼ ä¸é‡è¯•æœºåˆ¶
- æä¾›è¯¦ç»†çš„å¤„ç†æ—¥å¿—ä¸é”™è¯¯ä¿¡æ¯

#### 2.2.3 RAG é—®ç­”ç³»ç»Ÿ
**åŠŸèƒ½æè¿°**: åŸºäºçŸ¥è¯†åº“çš„æ£€ç´¢å¢å¼ºç”Ÿæˆå¯¹è¯ç³»ç»Ÿ,ç¡®ä¿æ¯æ¡å›ç­”éƒ½æœ‰è¯æ®æ”¯æ’‘ã€‚

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·æé—® â†’ Queryå‘é‡åŒ– â†’ æ··åˆæ£€ç´¢(å‘é‡+å…¨æ–‡) â†’ ä¸Šä¸‹æ–‡æ„å»º 
   â†“           â†“              â†“                  â†“
Question   Embedding    pgvector RPC        Prompt Assembly
   â†“                                             â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> GLM-4.7 æµå¼ç”Ÿæˆ
                                               â†“
                                      Answer + Citations
```

**æ ¸å¿ƒç‰¹æ€§**:
- **æµå¼è¾“å‡º**: ä½¿ç”¨ SSE åè®®å®æ—¶è¿”å›ç”Ÿæˆå†…å®¹
- **å¼•ç”¨æº¯æº**: æ¯æ¡å›ç­”é™„å¸¦ citations(chunkçº§åˆ«å®šä½)
- **æ£€ç´¢è¯¦æƒ…**: å¯è§†åŒ–å±•ç¤ºæ£€ç´¢å‚æ•°ã€TopKã€åˆ†æ•°ä¸è€—æ—¶
- **æ— è¯æ®å¤„ç†**: æ£€ç´¢ä¸åˆ°ä¾æ®æ—¶æ‹’ç­”å¹¶æç¤ºè¡¥å……èµ„æ–™

**æ£€ç´¢ç­–ç•¥**:
- å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢: åŸºäºä½™å¼¦è·ç¦»çš„å‘é‡åŒ¹é…
- æ··åˆæ£€ç´¢: å‘é‡(0.7) + å…¨æ–‡æ£€ç´¢(0.3)åŠ æƒèåˆ
- TopK æ§åˆ¶: é»˜è®¤è¿”å› 8 ä¸ªæœ€ç›¸å…³ç‰‡æ®µ
- é˜ˆå€¼è¿‡æ»¤: ç›¸ä¼¼åº¦ä½äºé˜ˆå€¼çš„ç»“æœè¢«è¿‡æ»¤

#### 2.2.4 Studio äº§ç‰©ç”ŸæˆåŠŸèƒ½
**åŠŸèƒ½æè¿°**: åŸºäºçŸ¥è¯†åº“å†…å®¹ä¸€é”®ç”Ÿæˆç»“æ„åŒ–äº§ç‰©(å¤§çº²/æµ‹éªŒ/æ€ç»´å¯¼å›¾ç­‰)ã€‚

**ç”Ÿæˆæ¨¡å¼**:
- **Fast æ¨¡å¼**: æ™ºèƒ½é‡‡æ ·ä¸Šä¸‹æ–‡,ç›´æ¥è°ƒç”¨æ¨¡å‹ç”Ÿæˆ(é€Ÿåº¦ä¼˜å…ˆ)
- **Precise æ¨¡å¼**: Map-Reduce ç­–ç•¥,é€ Source ç”Ÿæˆå†åˆå¹¶(å‡†ç¡®æ€§ä¼˜å…ˆ)

**äº§ç‰©ç±»å‹**:
- æ‘˜è¦(Summary): æç‚¼æ ¸å¿ƒè¦ç‚¹
- å¤§çº²(Outline): åˆ†å±‚ç»“æ„åŒ–ç»„ç»‡
- æµ‹éªŒ(Quiz): Q&A åˆ—è¡¨ç”Ÿæˆ
- æ€ç»´å¯¼å›¾(MindMap): å¯è§†åŒ–çŸ¥è¯†ç»“æ„

**æ¨¡æ¿ç³»ç»Ÿ**:
- æ”¯æŒ Prompt æ¨¡æ¿çš„ä¿å­˜ä¸å¤ç”¨
- æ¨¡æ¿å¯é…ç½®å˜é‡å ä½ç¬¦
- æ”¯æŒä¸€é”®è¿è¡Œå¹¶ç”Ÿæˆ Artifact

#### 2.2.5 å‘é‡æ£€ç´¢å¼•æ“
**æŠ€æœ¯å®ç°**: åŸºäº PostgreSQL + pgvector æ‰©å±•å®ç°é«˜æ€§èƒ½å‘é‡æ£€ç´¢ã€‚

**å‘é‡å­˜å‚¨è®¾è®¡**:
```sql
document_chunks è¡¨ç»“æ„:
- id (bigserial PK)
- notebook_id (uuid, ç´¢å¼•)
- source_id (uuid, ç´¢å¼•)
- chunk_index (int)
- content (text)
- content_hash (text, å»é‡)
- metadata (jsonb, é¡µç /ä½ç½®ç­‰)
- embedding (vector(1024), HNSWç´¢å¼•)
- embedding_model (text)
- embedding_dim (int)
- content_tsv (tsvector, å…¨æ–‡æ£€ç´¢)
- created_at (timestamptz)
```

**ç´¢å¼•ç­–ç•¥**:
- HNSW å‘é‡ç´¢å¼•: ä½¿ç”¨ vector_cosine_ops
- GIN å…¨æ–‡ç´¢å¼•: æ”¯æŒå¤šè¯­è¨€æ£€ç´¢
- å¤åˆç´¢å¼•: (notebook_id, source_id, chunk_index)

**æ£€ç´¢ç®—æ³•**:
- ç›¸ä¼¼åº¦è®¡ç®—: 1 - (uÂ·v)/(|u||v|) (ä½™å¼¦è·ç¦»å˜æ¢)
- æ··åˆæ£€ç´¢: CTE ç»Ÿä¸€è¯„åˆ†é€»è¾‘,é¿å…é‡å¤è®¡ç®—
- é˜ˆå€¼è¿‡æ»¤: è¿‡æ»¤ä½ç›¸ä¼¼åº¦ç»“æœ

### 2.3 å…³é”®æŠ€æœ¯é€‰å‹

#### 2.3.1 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€”è¯´æ˜ |
|------|------|---------|
| Node.js | 20 LTS | è¿è¡Œæ—¶ç¯å¢ƒ(è¦æ±‚ â‰¥18.17) |
| Next.js | 14.2.35 | å…¨æ ˆæ¡†æ¶,App Router ç¨³å®š |
| React | 18.2.0 | UI æ¡†æ¶,å¹¶å‘ç‰¹æ€§ |
| TypeScript | 5.9.3 | ç±»å‹ç³»ç»Ÿ,å¼ºç±»å‹ä¿éšœ |
| Tailwind CSS | 3.4.1 | åŸå­åŒ–æ ·å¼æ¡†æ¶ |
| shadcn/ui | 0.8.0 | åŸºç¡€ç»„ä»¶åº“(Radix UI) |
| ant-design X | 2.1.1 | AI å¯¹è¯ç»„ä»¶åº“ |
| Zustand | 4.4.1 | è½»é‡çº§çŠ¶æ€ç®¡ç† |
| lucide-react | 0.292.0 | å›¾æ ‡åº“ |

**é€‰å‹ç†ç”±**:
- Next.js 14 + React 18 ç»„åˆç¨³å®š,é¿å… React 19 è¿ç§»æˆæœ¬
- Tailwind CSS å¿«é€Ÿæ„å»ºä¸€è‡´çš„è§†è§‰é£æ ¼
- shadcn/ui æä¾›å¯è®¿é—®æ€§ä¸å¯ç»„åˆæ€§ä¿éšœ

#### 2.3.2 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€”è¯´æ˜ |
|------|------|---------|
| Supabase JS | 2.89.0 | è®¤è¯/å­˜å‚¨/æ•°æ®åº“ |
| Supabase SSR | 0.8.0 | Next.js SSR é€‚é… |
| Prisma | 7.2.0 | ORM,ä¸šåŠ¡è¡¨ç®¡ç† |
| PostgreSQL | Supabase æ‰˜ç®¡ | å…³ç³»æ•°æ®åº“ |
| pgvector | â‰¥0.6 | å‘é‡æ‰©å±•,HNSW ç´¢å¼• |
| Vercel AI SDK | 4.3.19 | æµå¼ UI/hooks |
| LangChain.js | 1.2.3 | RAG/é“¾è·¯ç»„è£… |
| Zod | 3.25.76 | å…¥å‚æ ¡éªŒ |

**è¿æ¥æ± é…ç½®**:
- è¿è¡Œæ—¶: Supabase Pooler (`DATABASE_URL?pgbouncer=true`)
- CLI è¿ç§»: ç›´è¿ (`DIRECT_URL`)

**å‘é‡èƒ½åŠ›å®ç°**:
- ä¸šåŠ¡è¡¨: Prisma ç®¡ç†
- å‘é‡è¡¨: SQL è¿ç§»åˆ›å»º + Prisma `$queryRaw` è°ƒç”¨

#### 2.3.3 AI æ¨¡å‹é›†æˆ

**Embedding æ¨¡å‹**: æ™ºè°± Embedding-3
- **å‘é‡ç»´åº¦**: 1024 ç»´(å¯é€‰ 256/512/1024/2048)
- **é€‰å‹ç†ç”±**: 
  - é«˜ç²¾åº¦è¯­ä¹‰æœç´¢,é€‚ç”¨äºä¸“ä¸šçŸ¥è¯†åº“
  - ä»·æ ¼ä¼˜åŠ¿: 0.5 å…ƒ/ç™¾ä¸‡ Tokens
  - æ”¯æŒè‡ªå®šä¹‰ç»´åº¦,æ»¡è¶³ pgvector ç´¢å¼•é™åˆ¶(â‰¤2000)
- **æ‰¹é‡é™åˆ¶**: å•æ¬¡æœ€å¤š 64 æ¡,å•æ¡ â‰¤3072 tokens

**ç”Ÿæˆæ¨¡å‹**: æ™ºè°± GLM-4.7 + LongCat
- **GLM-4.7**: RAG é—®ç­”ã€å¯¹è¯å»ºè®®é—®é¢˜ç”Ÿæˆ
- **LongCat**: Studio æ¨¡å¼ä¸“ç”¨,æ”¯æŒ Map-Reduce ç”Ÿæˆç­–ç•¥

**é›†æˆæ¶æ„**:
```
Indexing é“¾è·¯:
Upload/URL â†’ æ–‡æœ¬æŠ½å– â†’ Chunk â†’ Embedding-3 â†’ pgvector

Retrieval é“¾è·¯:
Query â†’ Embedding-3 â†’ pgvector RPC â†’ topK chunks

Generation é“¾è·¯:
topK chunks â†’ Prompt ç»„è£… â†’ GLM-4.7 â†’ Answer + Citations
```

### 2.4 å…¶ä»–å…³é”®æŠ€æœ¯

#### 2.4.1 æ–‡æœ¬å¤„ç†
- **PDF è§£æ**: pdf-parse(çº¯æ–‡æœ¬ PDF), OCR å¯é€‰(æ‰«æç‰ˆ)
- **ç½‘é¡µè§£æ**: @mozilla/readability(æ­£æ–‡æŠ½å–)
- **Word è§£æ**: mammoth(docx è½¬æ–‡æœ¬)
- **æ–‡æœ¬åˆ‡åˆ†**: RecursiveCharacterTextSplitter, Token ä¼°ç®—

#### 2.4.2 å¯è§†åŒ–æ¸²æŸ“
- **æ€ç»´å¯¼å›¾**: @ant-design/x + @xyflow/react + dagre(å¸ƒå±€)
- **Markdown**: @ant-design/x-markdown(å¯Œæ–‡æœ¬æ¸²æŸ“)
- **ä»£ç é«˜äº®**: å†…ç½®è¯­æ³•é«˜äº®æ”¯æŒ

#### 2.4.3 å®‰å…¨ä¸è®¤è¯
- **èº«ä»½è®¤è¯**: Supabase Auth(Cookie ä¼šè¯)
- **è·¯ç”±ä¿æŠ¤**: Next.js Middleware ç»Ÿä¸€æ‹¦æˆª
- **æƒé™æ ¡éªŒ**: API å±‚æ ¡éªŒ ownerId,Prisma ç»•è¿‡ RLS éœ€åº”ç”¨å±‚éš”ç¦»
- **æ–‡ä»¶å­˜å‚¨**: Supabase Storage RLS ç­–ç•¥,æŒ‰ ownerId éš”ç¦»

#### 2.4.4 æ€§èƒ½ä¼˜åŒ–
- **è¿æ¥æ± **: Prisma + pg Pool é€‚é… Serverless ç¯å¢ƒ
- **æ‰¹é‡å†™å…¥**: å‘é‡è¡¨åˆ†æ‰¹æ’å…¥(500 æ¡/æ‰¹),é¿å…é•¿äº‹åŠ¡
- **æ£€ç´¢ä¼˜åŒ–**: CTE é¿å…é‡å¤è®¡ç®—,HNSW ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
- **ç¼“å­˜æœºåˆ¶**: Query embedding çŸ­ TTL ç¼“å­˜, content_hash å»é‡

---

## ä¸‰ã€é¡¹ç›®è®¡åˆ’

### 3.1 å¯è¡Œæ€§åˆ†æ

#### 3.1.1 æŠ€æœ¯å¯è¡Œæ€§

**æˆç†Ÿåº¦è¯„ä¼°**:
- âœ… Next.js 14 + React 18 ç”Ÿæ€æˆç†Ÿ,ç¤¾åŒºæ´»è·ƒ
- âœ… Supabase + Prisma + pgvector ç»„åˆå·²æœ‰å¤§é‡ç”Ÿäº§æ¡ˆä¾‹
- âœ… æ™ºè°± Embedding-3 + GLM-4.7 API ç¨³å®š,æ–‡æ¡£å®Œå–„
- âœ… LangChain.js æä¾›æˆç†Ÿçš„ RAG é“¾è·¯ç¼–æ’èƒ½åŠ›

**æŠ€æœ¯é£é™©**:
| é£é™©ç‚¹ | é£é™©ç­‰çº§ | ç¼“è§£æªæ–½ |
|--------|---------|---------|
| å‘é‡ç»´åº¦ä¸ä¸€è‡´å¯¼è‡´æ•°æ®æŸå | ğŸ”´ P0 | å¯åŠ¨æ—¶å¼ºåˆ¶æ ¡éªŒ EMBEDDING_DIM,è¿ç§»è„šæœ¬æ˜ç¡®ç»´åº¦ |
| PDF è§£æå¤±è´¥(åŠ å¯†/æŸå) | ğŸ”´ P0 | å¢å¼º Source è¡¨å­—æ®µ,æ”¯æŒ processingLog ä¸æ–­ç‚¹ç»­ä¼  |
| Embedding API é™æµ/æ•…éšœ | ğŸ”´ P0 | æŒ‡æ•°é€€é¿é‡è¯•,æ‰¹é‡è°ƒç”¨é™ä½ QPS |
| Citations æ—¶åºé—®é¢˜ | ğŸŸ¡ P1 | åŒé˜¶æ®µæµå¼,æµç»“æŸåè¿½åŠ  citations |
| å¤§æ–‡ä»¶å¤„ç†è¶…æ—¶ | ğŸŸ¢ P2 | å¼•å…¥å¤„ç†é˜Ÿåˆ—,å¼‚æ­¥å¤„ç† |

**æ¶æ„é£é™©æ§åˆ¶**:
- P0 é£é™©: ç¬¬ 1 å‘¨å®Œæˆ,é˜»å¡åç»­å¼€å‘
- P1 é£é™©: ç¬¬ 4 å‘¨å®Œæˆ,å½±å“ç”¨æˆ·ä½“éªŒ
- P2 é£é™©: ç¬¬ 6 å‘¨å®Œæˆ,æ€§èƒ½ä¼˜åŒ–

#### 3.1.2 æˆæœ¬å¯è¡Œæ€§

**å¼€å‘æˆæœ¬**:
- äººåŠ›: 2 åå…¨æ ˆå·¥ç¨‹å¸ˆ Ã— 6 å‘¨ = 12 äººå‘¨
- æ—¶é—´: 1.5 ä¸ªæœˆ(å«æµ‹è¯•ä¸æ‰“ç£¨)

**è¿è¥æˆæœ¬**(æœˆå‡):
| æˆæœ¬é¡¹ | é¢„ä¼°è´¹ç”¨ | è¯´æ˜ |
|--------|---------|------|
| Supabase æœåŠ¡ | $25/æœˆ | Pro è®¡åˆ’,å« Auth + Storage + Postgres |
| æ™ºè°± API è°ƒç”¨ | ~$50/æœˆ | å‡è®¾ 100M tokens(Embedding) + 10M tokens(Chat) |
| Vercel éƒ¨ç½² | $20/æœˆ | Pro è®¡åˆ’,æ”¯æŒ Cron Job ä¸ Edge Function |
| **åˆè®¡** | **~$95/æœˆ** | MVP é˜¶æ®µ,ç”¨æˆ·é‡å¢é•¿åéœ€æ‰©å®¹ |

**ROI åˆ†æ**:
- ä¸€æœŸ MVP å¯å¿«é€ŸéªŒè¯äº§å“æ–¹å‘
- æŠ€æœ¯æ¶æ„å¯å¹³æ»‘æ‰©å±•è‡³ ToB åœºæ™¯
- å·®å¼‚åŒ–äº®ç‚¹(Workflow åº•åº§/é“¾è·¯å¯è§†åŒ–)æœ‰å•†ä¸šåŒ–æ½œåŠ›

#### 3.1.3 å›¢é˜Ÿå¯è¡Œæ€§

**å›¢é˜Ÿèƒ½åŠ›è¦æ±‚**:
- âœ… å‰ç«¯: Next.js 14 + React 18 + TypeScript ç†Ÿç»ƒ
- âœ… åç«¯: Prisma + PostgreSQL + API è®¾è®¡ç»éªŒ
- âœ… AI: ç†è§£ RAG åŸç†,æœ‰ LLM API è°ƒç”¨ç»éªŒ
- âš ï¸ å‘é‡æ£€ç´¢: pgvector ç›¸å¯¹é™Œç”Ÿ,éœ€å­¦ä¹ 

**åˆ†å·¥ç­–ç•¥**:
- **å‰ç«¯ A(åäº§å“å£³)**: Notebook ç®¡ç†/Sources å¯¼å…¥/UI å¸ƒå±€
- **å‰ç«¯ B(å AI/RAG)**: Chat å¯¹è¯/RAG API/Studio åŠ¨ä½œ/é“¾è·¯å¯è§†åŒ–

**åä½œçº¦å®š**(ç¬¬ 1 å‘¨å®Œæˆ):
- æ•°æ®æ¨¡å‹å­—æ®µå‘½åä¸æ¥å£å¥‘çº¦
- `notebook_id` / `owner_id` éš”ç¦»ç­–ç•¥
- å‘é‡æ£€ç´¢ RPC åç§°ä¸å…¥å‚

### 3.2 æ’æœŸè§„åˆ’(6 å‘¨è¿­ä»£)

#### Week 1: é¡¹ç›®éª¨æ¶ + ç™»å½• + æ•°æ®æ¨¡å‹åŸºçº¿

**ç›®æ ‡**: èƒ½ç™»å½•ã€èƒ½åˆ›å»º Notebookã€èƒ½è¿›å…¥è¯¦æƒ…é¡µ(ç©ºå£³)

**å‰ç«¯ A ä»»åŠ¡**:
- [ ] Next.js 14.2.35 åˆå§‹åŒ–,åŸºç¡€å¸ƒå±€(é¦–é¡µ/Notebook/è®¾ç½®)
- [ ] Supabase Auth ç™»å½•/é€€å‡º(App Router + `@supabase/ssr`)
- [ ] Notebook åˆ—è¡¨é¡µ + åˆ›å»º/åˆ é™¤/æœ€è¿‘æ‰“å¼€ UI
- [ ] ğŸ”´ æ¶æ„é£é™©: æ­å»ºé”™è¯¯å¤„ç†è§„èŒƒ(ç»Ÿä¸€é”™è¯¯ç /Toast å±•ç¤º)

**å‰ç«¯ B ä»»åŠ¡**:
- [ ] Prisma åˆå§‹åŒ–(schemaã€migrate æµç¨‹)
- [ ] Supabase + Prisma è¿æ¥é…ç½®(pooler + ç›´è¿)
- [ ] `/api/chat` ç©ºå®ç°(å›æ˜¾) + `useChat` åŸºç¡€ UI
- [ ] ğŸ”´ æ¶æ„é£é™© 8.1: å®ç°å‘é‡ç»´åº¦ä¸€è‡´æ€§æ£€æŸ¥(å¯åŠ¨æ–­è¨€)
- [ ] ğŸ”´ æ¶æ„é£é™© 8.5: é…ç½® Supabase Storage bucket + RLS ç­–ç•¥

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ–°ç”¨æˆ·ç™»å½•åå¯åˆ›å»º Notebook å¹¶è¿›å…¥è¯¦æƒ…é¡µ
- âœ… èƒ½å‘é€æ¶ˆæ¯çœ‹åˆ°æµå¼è¿”å›(mock æ•°æ®)
- âœ… `EMBEDDING_DIM` ä¸ä¸€è‡´æ—¶å¯åŠ¨å¤±è´¥

---

#### Week 2: Source ç®¡ç† + ä¸Šä¼ /é“¾æ¥å…¥åº“ + ä»»åŠ¡çŠ¶æ€

**ç›®æ ‡**: å·¦ä¾§ Sources èƒ½æ–°å¢ç´ æå¹¶æ˜¾ç¤ºå¤„ç†çŠ¶æ€

**å‰ç«¯ A ä»»åŠ¡**:
- [ ] Sources å·¦æ  UI: åˆ—è¡¨/å‹¾é€‰å¯¼å…¥/çŠ¶æ€ badge(pending/processing/ready/failed)
- [ ] ä¸Šä¼ å…¥å£(PDF å¿…åš): å‰ç«¯ä¸Šä¼ åˆ° Supabase Storage
- [ ] å½•å…¥ URL Source(ç½‘é¡µé“¾æ¥)

**å‰ç«¯ B ä»»åŠ¡**:
- [ ] `/api/sources/upload`: åˆ›å»º Source è®°å½•(è¿”å› sourceId)
- [ ] `/api/sources/url`: åˆ›å»º URL Source
- [ ] `/api/sources/:id`: æŸ¥è¯¢çŠ¶æ€ä¸ meta
- [ ] ä»»åŠ¡çŠ¶æ€è½®è¯¢(SWR)æ–¹æ¡ˆå®šç¨¿

**éªŒæ”¶æ ‡å‡†**:
- âœ… ä¸Šä¼ /é“¾æ¥å,Source åˆ—è¡¨å¯è§å¹¶å±•ç¤ºçŠ¶æ€
- âœ… Notebook å†…å¯å‹¾é€‰"å‚ä¸å›ç­”çš„èµ„æ–™èŒƒå›´"

---

#### Week 3: è§£æ + Chunk + å‘é‡åŒ– + pgvector æ£€ç´¢è·‘é€š

**ç›®æ ‡**: å®Œæˆæœ€å° RAG ç´¢å¼•é“¾è·¯: PDF â†’ text â†’ chunks â†’ embeddings â†’ pgvector â†’ RPC æ£€ç´¢

**å‰ç«¯ A ä»»åŠ¡**:
- [ ] å¯¼å…¥è¿›åº¦ UI(è§£æä¸­/å‘é‡åŒ–ä¸­/å®Œæˆ)
- [ ] Source è¯¦æƒ…æŠ½å±‰/å¼¹å±‚: å±•ç¤ºåŸºç¡€æ‘˜è¦(å‰ N å­—)

**å‰ç«¯ B ä»»åŠ¡**:
- [ ] SQL è¿ç§»: `vector` æ‰©å±•ã€`document_chunks` è¡¨ã€HNSW ç´¢å¼•ã€`match_document_chunks` RPC
- [ ] `/api/sources/:id/ingest`: è§¦å‘è§£æä¸å‘é‡åŒ–
- [ ] æ¥å…¥æ™ºè°± Embedding-3(1024 ç»´)
- [ ] å®ç°æ–‡æœ¬åˆ‡åˆ†é€»è¾‘(RecursiveCharacterTextSplitter)
- [ ] æ‰¹é‡å‘é‡åŒ–ä¸å…¥åº“(500 æ¡/æ‰¹)

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç»™å®š query,å¯ä» RPC è¿”å› topK chunks(å« similarity)
- âœ… Source çŠ¶æ€å¯ä» processing å˜ä¸º ready

---

#### Week 4: RAG é—®ç­” + å¼•æ–‡é«˜äº®(æ ¸å¿ƒä½“éªŒæˆå‹)

**ç›®æ ‡**: Notebook å†…å®ç°"åŸºäºçŸ¥è¯†åº“å›ç­” + å¼•æ–‡é«˜äº® + æ‰¾ä¸åˆ°ä¾æ®æ‹’ç­”"

**å‰ç«¯ A ä»»åŠ¡**:
- [ ] å¼•ç”¨ UI(æ¶ˆæ¯ä¸‹æ–¹å¼•ç”¨å¡ç‰‡): ç‚¹å‡»å®šä½åˆ° chunk æ–‡æœ¬
- [ ] æºæ–‡æ¡£é¢„è§ˆ(MVP: å±•ç¤º chunk åˆ—è¡¨)

**å‰ç«¯ B ä»»åŠ¡**:
- [ ] `/api/chat`: RAG æ£€ç´¢ + ç»„è£… prompt + GLM-4.7 æµå¼ç”Ÿæˆ
- [ ] Citations ç»“æ„è½åœ°: æ£€ç´¢ chunk æ˜ å°„ä¸º citations
- [ ] "æ— ä¾æ®ç­–ç•¥": æ£€ç´¢åˆ†æ•°ä½äºé˜ˆå€¼æ—¶è¿”å› `answerMode=no_evidence`
- [ ] åŒé˜¶æ®µæµå¼: æµç»“æŸåè¿½åŠ  `__CITATIONS__` åˆ†éš”ç¬¦

**éªŒæ”¶æ ‡å‡†**:
- âœ… AI å›å¤å¿…é¡»å¸¦ citations,å¼•ç”¨å¯ç‚¹å‡»æ˜¾ç¤ºåŸæ–‡ç‰‡æ®µ
- âœ… æ— ä¾æ®æ—¶ä¸èƒ¡ç¼–,æç¤ºè¡¥å……èµ„æ–™

---

#### Week 5: Studio åŠ¨ä½œ + Prompt æ¨¡æ¿åº“ + äº§ç‰©ç®¡ç†

**ç›®æ ‡**: å³ä¾§ Studio è‡³å°‘ 2 ä¸ªåŠ¨ä½œå¯ç”Ÿæˆäº§ç‰©,å¹¶å¯å›çœ‹/å¤åˆ¶

**å‰ç«¯ A ä»»åŠ¡**:
- [ ] Studio UI: åŠ¨ä½œæŒ‰é’®åŒº/æ¨¡æ¿åº“åˆ—è¡¨/äº§ç‰©åˆ—è¡¨(Artifacts)
- [ ] äº§ç‰©æ¸²æŸ“(Markdown/JSON) + å¤åˆ¶/ä¸‹è½½

**å‰ç«¯ B ä»»åŠ¡**:
- [ ] `/api/studio/generate`: åŸºäº GLM-4.7 å®ç°åŠ¨ä½œ(å¤§çº²/æµ‹éªŒ è‡³å°‘ 2 ä¸ª)
- [ ] Fast/Precise ä¸¤ç§ç”Ÿæˆç­–ç•¥
- [ ] PromptTemplate CRUD(ä¿å­˜/ç¼–è¾‘/åˆ é™¤)
- [ ] Artifact è½åº“(Prisma)

**éªŒæ”¶æ ‡å‡†**:
- âœ… è‡³å°‘ 2 ç§äº§ç‰©å¯ä¸€é”®ç”Ÿæˆå¹¶ä¿å­˜
- âœ… æ¨¡æ¿å¯å¤ç”¨,è¿è¡Œæ—¶å¯é€‰æ‹© Sources èŒƒå›´

---

#### Week 6: å·®å¼‚åŒ–äº®ç‚¹æ”¶å£ + Demo æ‰“ç£¨

**ç›®æ ‡**: åšå‡º"å¯å±•ç¤ºä¼˜åŠ¿"çš„æ¼”ç¤ºç‰ˆæœ¬: RAG é“¾è·¯å¯è§†åŒ– Lite + ä½“éªŒæ‰“ç£¨

**å‰ç«¯ A ä»»åŠ¡**:
- [ ] UI/UX æ‰“ç£¨: ç©ºçŠ¶æ€/åŠ è½½æ€/é”™è¯¯æ€/å¿«æ·å…¥å£/é”®ç›˜ä½“éªŒ
- [ ] é¦–é¡µç²¾é€‰/æœ€è¿‘æ‰“å¼€å®Œå–„

**å‰ç«¯ B ä»»åŠ¡**:
- [ ] RAG é“¾è·¯å¯è§†åŒ– Lite: å±•ç¤º topK chunks(åˆ†æ•°/æ¥æº/ç‰‡æ®µ)
- [ ] æ€§èƒ½ä¸æˆæœ¬: ç¼“å­˜ embeddingã€topKã€è¯·æ±‚å»é‡
- [ ] æ··åˆæ£€ç´¢å®ç°(å¯é€‰)

**éªŒæ”¶æ ‡å‡†**:
- âœ… Demo æµç¨‹å¯é¡ºç•…æ¼”ç¤º: å¯¼å…¥ â†’ é—®ç­” â†’ å¼•ç”¨ â†’ åŠ¨ä½œäº§ç‰© â†’ é“¾è·¯è§£é‡Š

---

### 3.3 é‡Œç¨‹ç¢‘ & å…³é”®æˆæœç‰©

| é‡Œç¨‹ç¢‘ | æ—¶é—´èŠ‚ç‚¹ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|--------|---------|-------|---------|
| M1: é¡¹ç›®éª¨æ¶å®Œæˆ | Week 1 | ç™»å½•ç³»ç»Ÿ + Notebook CRUD | ç”¨æˆ·å¯ç™»å½•å¹¶åˆ›å»º Notebook |
| M2: Source å¯¼å…¥å°±ç»ª | Week 2 | æ–‡ä»¶ä¸Šä¼  + é“¾æ¥å¯¼å…¥ | Source åˆ—è¡¨å¯è§å¹¶å±•ç¤ºçŠ¶æ€ |
| M3: RAG ç´¢å¼•é“¾è·¯æ‰“é€š | Week 3 | å‘é‡åŒ– + pgvector æ£€ç´¢ | RPC å¯è¿”å› topK chunks |
| M4: æ ¸å¿ƒå¯¹è¯ä½“éªŒæˆå‹ | Week 4 | RAG é—®ç­” + å¼•æ–‡é«˜äº® | AI å›å¤å¸¦ citations,å¯è¿½æº¯ |
| M5: Studio äº§ç‰©ç”Ÿæˆ | Week 5 | è‡³å°‘ 2 ä¸ªåŠ¨ä½œ + æ¨¡æ¿åº“ | å¯ç”Ÿæˆå¤§çº²/æµ‹éªŒå¹¶ä¿å­˜ |
| M6: MVP æ¼”ç¤ºç‰ˆæœ¬ | Week 6 | é“¾è·¯å¯è§†åŒ– + Demo æ‰“ç£¨ | å®Œæ•´æµç¨‹å¯æ¼”ç¤º |

---

### 3.4 é£é™©ç®¡ç†çŸ©é˜µ

#### ğŸ”´ P0 çº§é£é™©(å¿…é¡»åœ¨å¯¹åº”å‘¨å®Œæˆ)

| é£é™©ç¼–å· | é£é™©åç§° | å½±å“ | è´Ÿè´£äºº | è®¡åˆ’å‘¨ | ç¼“è§£æªæ–½ |
|---------|---------|------|--------|--------|---------|
| 8.1 | å‘é‡ç»´åº¦ä¸ä¸€è‡´ | æ•°æ®æŸå,æ£€ç´¢é”™è¯¯ | å‰ç«¯ B | Week 1 | å¯åŠ¨æ–­è¨€æ£€æŸ¥ EMBEDDING_DIM,è¿ç§»è„šæœ¬æ˜ç¡®ç»´åº¦ |
| 8.2 | æ–‡ä»¶è§£æé”™è¯¯æ¢å¤ | ç”¨æˆ·çœ‹åˆ°"å¤„ç†ä¸­"ä½†å®é™…å·²å¤±è´¥ | å‰ç«¯ B | Week 2-3 | Source è¡¨åŒ…å« processingLog/retryCount,æ”¯æŒæ–­ç‚¹ç»­ä¼  |
| 8.5 | Storage æ–‡ä»¶ç®¡ç† | æƒé™æ³„éœ²,å­˜å‚¨æ³„æ¼ | A+B | Week 1-2 | RLS ç­–ç•¥,åˆ é™¤ Source çº§è”åˆ é™¤æ–‡ä»¶ |

#### ğŸŸ¡ P1 çº§é£é™©(å¼ºçƒˆå»ºè®®)

| é£é™©ç¼–å· | é£é™©åç§° | å½±å“ | è´Ÿè´£äºº | è®¡åˆ’å‘¨ | ç¼“è§£æªæ–½ |
|---------|---------|------|--------|--------|---------|
| 8.3 | Citations å»é‡ | ç›¸åŒå†…å®¹é‡å¤å‘é‡åŒ–,å¼•ç”¨å†—ä½™ | å‰ç«¯ B | Week 4 | content_hash å»é‡,å¤ç”¨ embedding |
| 8.4 | æµå¼ Citations æ—¶åº | ç”¨æˆ·çœ‹åˆ°ç­”æ¡ˆä½†å¼•ç”¨å»¶è¿Ÿ | å‰ç«¯ B | Week 4 | æµç»“æŸåè¿½åŠ  `__CITATIONS__`,å‰ç«¯è§£æ |

#### ğŸŸ¢ P2 çº§é£é™©(å¯é€‰ä¼˜åŒ–)

| é£é™©ç¼–å· | é£é™©åç§° | å½±å“ | è´Ÿè´£äºº | è®¡åˆ’å‘¨ | ç¼“è§£æªæ–½ |
|---------|---------|------|--------|--------|---------|
| 8.6 | é¢„å¤„ç†é˜Ÿåˆ— | å¤§æ–‡ä»¶åŒæ­¥å¤„ç†è¶…æ—¶ | å‰ç«¯ B | Week 3 | åˆ›å»º processing_queue è¡¨,Cron Worker å¼‚æ­¥å¤„ç† |
| 8.7 | æ··åˆæ£€ç´¢ | çº¯å‘é‡æ£€ç´¢å¯èƒ½æ¼å…³é”®è¯ | å‰ç«¯ B | Week 6 | å®ç° hybrid_search RPC(å‘é‡+FTS) |
| 8.8 | Embedding ç¼“å­˜ | é‡å¤ query æµªè´¹ API è°ƒç”¨ | å‰ç«¯ B | Week 6 | Query embedding ç¼“å­˜,å‘½ä¸­ç‡ >30% |

---

### 3.5 æ¯å‘¨æ£€æŸ¥æ¸…å•

#### Week 1 Checklist
- [ ] ç¯å¢ƒå˜é‡ `EMBEDDING_DIM=1024` å·²é…ç½®
- [ ] ä»£ç ä¸­æœ‰å¯åŠ¨æ–­è¨€æ£€æŸ¥ç»´åº¦ä¸€è‡´æ€§
- [ ] Supabase Storage bucket `notebook-sources` å·²åˆ›å»º
- [ ] RLS ç­–ç•¥å·²é…ç½®(ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ–‡ä»¶)
- [ ] é”™è¯¯å¤„ç†è§„èŒƒæ–‡æ¡£å·²è¾“å‡º

#### Week 2 Checklist
- [ ] Source è¡¨åŒ…å« `processingLog`/`lastProcessedChunkIndex`/`retryCount`/`errorMessage`
- [ ] `processing_queue` è¡¨å·²åˆ›å»º
- [ ] ä¸Šä¼ æ–‡ä»¶è·¯å¾„éµå¾ª `{ownerId}/{notebookId}/{sourceId}_{timestamp}.ext`
- [ ] å‰ç«¯è½®è¯¢ `/api/sources/:id` å¯çœ‹åˆ° `processingLog` æ›´æ–°

#### Week 3 Checklist
- [ ] `document_chunks` è¡¨åŒ…å« `content_hash`/`embedding_model`/`embedding_dim`
- [ ] HNSW ç´¢å¼•å·²åˆ›å»º(`vector_cosine_ops`)
- [ ] è°ƒç”¨ Embedding API æ—¶å¼ºåˆ¶æŒ‡å®š `dimensions: 1024`
- [ ] å®ç°æŒ‡æ•°é€€é¿é‡è¯•(429/5xx é”™è¯¯)
- [ ] è§£æå¤±è´¥æ—¶æ›´æ–° `processingLog.stages.parse.error`

#### Week 4 Checklist
- [ ] Citations ç»“æ„åŒ…å« `chunkId`/`sourceId`/`score`/`locator`/`excerpt`
- [ ] æµå¼è¾“å‡ºåœ¨æ–‡æœ¬ç»“æŸåè¿½åŠ  `__CITATIONS__` åˆ†éš”ç¬¦
- [ ] å‰ç«¯ `onFinish` å›è°ƒæ­£ç¡®è§£æ citations
- [ ] ç›¸åŒ `content_hash` çš„ chunk å¤ç”¨ embedding
- [ ] æ£€ç´¢ç»“æœæŒ‰ `content_hash` å»é‡

#### Week 5 Checklist
- [ ] è‡³å°‘ 2 ä¸ª Studio åŠ¨ä½œå¯ç”Ÿæˆäº§ç‰©
- [ ] Artifact è¡¨åŒ…å« `type`/`input`/`content`
- [ ] PromptTemplate CRUD API å·²å®ç°

#### Week 6 Checklist
- [ ] RAG é“¾è·¯å¯è§†åŒ–é¢æ¿å±•ç¤º topK chunks
- [ ] Query embedding ç¼“å­˜å·²å®ç°
- [ ] åˆ é™¤ Source æ—¶çº§è”åˆ é™¤æ–‡ä»¶å’Œ chunks
- [ ] Demo æµç¨‹å¯å®Œæ•´æ¼”ç¤º(å½•å±å¤‡ç”¨)

---

## å››ã€é™„å½•

### é™„å½• A: æ•°æ®æ¨¡å‹è¯¦ç»†è®¾è®¡

#### A.1 ä¸šåŠ¡è¡¨(Prisma ç®¡ç†)

**Notebook è¡¨**
```typescript
model Notebook {
  id            String   @id @default(uuid())
  ownerId       String   // Supabase Auth user id
  title         String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  lastOpenedAt  DateTime @default(now())
  
  sources       Source[]
  messages      Message[]
  artifacts     Artifact[]
}
```

**Source è¡¨**
```typescript
model Source {
  id                       String   @id @default(uuid())
  notebookId               String
  type                     String   // 'file' | 'url' | 'video'
  title                    String
  status                   String   // 'pending' | 'processing' | 'ready' | 'failed'
  storagePath              String?
  url                      String?
  meta                     Json?
  processingLog            Json?    // å¤„ç†æ—¥å¿—
  lastProcessedChunkIndex  Int      @default(0)
  retryCount               Int      @default(0)
  errorMessage             String?
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
  
  notebook                 Notebook @relation(fields: [notebookId], references: [id], onDelete: Cascade)
}
```

**Message è¡¨**
```typescript
model Message {
  id          String   @id @default(uuid())
  notebookId  String
  role        String   // 'user' | 'assistant' | 'system'
  content     String   @db.Text
  citations   Json?    // Citations JSON
  metadata    Json?    // retrievalDetails ç­‰
  createdAt   DateTime @default(now())
  
  notebook    Notebook @relation(fields: [notebookId], references: [id], onDelete: Cascade)
}
```

**Artifact è¡¨**
```typescript
model Artifact {
  id          String   @id @default(uuid())
  notebookId  String
  type        String   // 'summary' | 'outline' | 'quiz' | 'mindmap'
  content     String   @db.Text
  metadata    Json?    // ç»Ÿè®¡ä¿¡æ¯ç­‰
  createdAt   DateTime @default(now())
  
  notebook    Notebook @relation(fields: [notebookId], references: [id], onDelete: Cascade)
}
```

**PromptTemplate è¡¨**
```typescript
model PromptTemplate {
  id        String   @id @default(uuid())
  ownerId   String
  name      String
  template  String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

#### A.2 å‘é‡è¡¨(SQL è¿ç§»)

```sql
CREATE TABLE document_chunks (
  id                BIGSERIAL PRIMARY KEY,
  notebook_id       UUID NOT NULL,
  source_id         UUID NOT NULL,
  chunk_index       INT NOT NULL,
  content           TEXT NOT NULL,
  content_hash      TEXT,
  metadata          JSONB DEFAULT '{}',
  embedding         vector(1024) NOT NULL,
  embedding_model   TEXT DEFAULT 'embedding-3',
  embedding_dim     INT DEFAULT 1024,
  content_tsv       tsvector,
  created_at        TIMESTAMPTZ DEFAULT NOW(),
  
  UNIQUE(source_id, chunk_index)
);

-- HNSW å‘é‡ç´¢å¼•
CREATE INDEX idx_embedding ON document_chunks 
USING hnsw (embedding vector_cosine_ops);

-- å…¶ä»–ç´¢å¼•
CREATE INDEX idx_notebook_id ON document_chunks(notebook_id);
CREATE INDEX idx_source_id ON document_chunks(source_id);
CREATE INDEX idx_content_hash ON document_chunks(content_hash);
CREATE INDEX idx_content_fts ON document_chunks USING GIN(content_tsv);
```

---

### é™„å½• B: API æ¥å£è§„èŒƒ

#### B.1 Notebook ç®¡ç†

**åˆ›å»º Notebook**
```
POST /api/notebooks
Request: { title: string }
Response: { id: uuid, title: string, createdAt: timestamp }
```

**è·å– Notebook åˆ—è¡¨**
```
GET /api/notebooks
Response: { notebooks: Notebook[], recentOpened: Notebook[] }
```

**è®°å½•æœ€è¿‘æ‰“å¼€**
```
POST /api/notebooks/:id/open
Response: { success: true }
```

#### B.2 Source ç®¡ç†

**ä¸Šä¼ æ–‡ä»¶**
```
POST /api/sources/upload
Request: FormData { file: File, notebookId: uuid }
Response: { sourceId: uuid, status: 'pending' }
```

**åˆ›å»º URL Source**
```
POST /api/sources/url
Request: { url: string, notebookId: uuid }
Response: { sourceId: uuid, status: 'pending' }
```

**è·å– Source çŠ¶æ€**
```
GET /api/sources/:id
Response: {
  id: uuid,
  title: string,
  status: 'pending' | 'processing' | 'ready' | 'failed',
  processingLog: {...},
  lastProcessedChunkIndex: number,
  errorMessage?: string
}
```

**è§¦å‘å¤„ç†**
```
POST /api/sources/:id/ingest
Response: { status: 'processing' }
```

#### B.3 RAG é—®ç­”

**Chat æ¥å£**
```
POST /api/chat
Request: {
  messages: Message[],
  notebookId: uuid,
  selectedSourceIds?: uuid[],
  mode: 'fast' | 'precise'
}
Response: SSE Stream
  - æµå¼æ–‡æœ¬ç‰‡æ®µ
  - æµç»“æŸå: __CITATIONS__{"data": [...], "answerMode": "grounded"}
```

#### B.4 Studio åŠ¨ä½œ

**ç”Ÿæˆäº§ç‰©**
```
POST /api/studio/generate
Request: {
  notebookId: uuid,
  type: 'summary' | 'outline' | 'quiz' | 'mindmap',
  mode: 'fast' | 'precise',
  sourceIds?: uuid[]
}
Response: {
  content: string,
  stats: { generationTime: number, ... }
}
```

**æ¨¡æ¿ CRUD**
```
POST /api/templates
GET /api/templates
PUT /api/templates/:id
DELETE /api/templates/:id
```

---

### é™„å½• C: Citations JSON ç»“æ„

```typescript
interface Citation {
  chunkId: number;
  sourceId: string;
  notebookId: string;
  score: number;          // ç›¸ä¼¼åº¦åˆ†æ•°
  locator: {              // ä½ç½®ä¿¡æ¯
    page?: number;        // PDF é¡µç 
    startChar?: number;   // å­—ç¬¦åç§»
    endChar?: number;
    url?: string;         // ç½‘é¡µé“¾æ¥
    timestamp?: number;   // è§†é¢‘æ—¶é—´æˆ³(ç§’)
  };
  excerpt: string;        // åŸæ–‡ç‰‡æ®µ(â‰¤200å­—)
}

interface CitationsResponse {
  citations: Citation[];
  answerMode: 'grounded' | 'no_evidence';
}
```

---

### é™„å½• D: æŠ€æœ¯å€ºåŠ¡ç™»è®°

| å€ºåŠ¡é¡¹ | å½“å‰æ–¹æ¡ˆ | ç†æƒ³æ–¹æ¡ˆ | ä¼˜å…ˆçº§ | é¢„ä¼°å·¥ä½œé‡ |
|--------|---------|---------|--------|-----------|
| æ— åˆ†å¸ƒå¼é” | å¹¶å‘å¯¼å…¥åŒä¸€æ–‡ä»¶å¯èƒ½é‡å¤ | Redis åˆ†å¸ƒå¼é” | P2 | 1å¤© |
| åŒæ­¥å¤„ç†å¤§æ–‡ä»¶ | API å¯èƒ½è¶…æ—¶ | çœŸæ­£çš„å¼‚æ­¥é˜Ÿåˆ—(BullMQ) | P1 | 3å¤© |
| çº¯å‘é‡æ£€ç´¢ | å¯èƒ½æ¼æ‰å…³é”®è¯ | æ··åˆæ£€ç´¢(å·²åœ¨ Week 6 æä¾›) | P1 | 3å¤© |
| æ— ç›‘æ§å‘Šè­¦ | ä¾èµ–æ—¥å¿—æ’æŸ¥ | Sentry + è‡ªå®šä¹‰ Dashboard | P2 | 2å¤© |
| Chunk å›ºå®šå¤§å° | å¯èƒ½åˆ‡æ–­è¯­ä¹‰ | è¯­ä¹‰åˆ‡åˆ†(LangChain) | P3 | 2å¤© |

---

### é™„å½• E: ç¯å¢ƒå˜é‡é…ç½®æ¸…å•

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SECRET_KEY=xxx

# Prisma
DATABASE_URL=postgresql://postgres:xxx@db.xxx.supabase.co:6543/postgres?pgbouncer=true
DIRECT_URL=postgresql://postgres:xxx@db.xxx.supabase.co:5432/postgres

# æ™ºè°± AI
ZHIPU_API_KEY=xxx
ZHIPU_BASE_URL=https://open.bigmodel.cn/api
ZHIPU_EMBEDDING_MODEL=embedding-3
ZHIPU_CHAT_MODEL=glm-4.7

# LongCat
LONGCAT_API_KEY=xxx
LONGCAT_BASE_URL=xxx
LONGCAT_CHAT_MODEL=xxx

# å‘é‡ç»´åº¦(å¿…é¡»ä¸æ•°æ®åº“ä¸€è‡´)
EMBEDDING_DIM=1024

# Worker é‰´æƒ
CRON_SECRET=xxx
```

---

### é™„å½• F: å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘
npm run dev

# æ„å»ºä¸å¯åŠ¨
npm run build
npm run start

# è´¨é‡æ£€æŸ¥
npm run lint
npm run type-check

# Prisma
npm run db:generate    # ç”Ÿæˆå®¢æˆ·ç«¯
npm run db:push        # æ¨é€ schema åˆ°æ•°æ®åº“
npm run db:migrate     # åˆ›å»ºå¹¶è¿è¡Œè¿ç§»
npm run db:studio      # æ‰“å¼€ Prisma Studio
```

---

## ç»“è¯­

æœ¬é¡¹ç›®è®¡åˆ’ä¹¦è¯¦ç»†é˜è¿°äº† NotebookLM Clone é¡¹ç›®çš„èƒŒæ™¯ã€ç›®çš„ã€æŠ€æœ¯æ–¹æ¡ˆä¸å®æ–½è®¡åˆ’ã€‚é€šè¿‡ 6 å‘¨çš„è¿­ä»£å¼€å‘,æˆ‘ä»¬å°†äº¤ä»˜ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„ MVP ç‰ˆæœ¬,å®ç°"çŸ¥è¯†å¯¼å…¥ â†’ å‘é‡åŒ– â†’ RAG å¯¹è¯ â†’ äº§ç‰©ç”Ÿæˆ"çš„å®Œæ•´é—­ç¯ã€‚

**é¡¹ç›®æ ¸å¿ƒä¼˜åŠ¿**:
1. **å¯è¿½æº¯æ€§**: æ¯æ¡å›ç­”å¿…é¡»åŸºäºè¯æ®,æ”¯æŒå¼•ç”¨æº¯æºä¸æ£€ç´¢é“¾è·¯å¯è§†åŒ–
2. **å¯æ‰©å±•æ€§**: Agent/Workflow åº•åº§æ¶æ„,å¯å¹³æ»‘æ¼”è¿›è‡³å¯è§†åŒ–ç¼–æ’
3. **ä¸¥æ ¼çº¦æŸ**: æ‰¾ä¸åˆ°ä¾æ®åˆ™æ‹’ç­”,é™ä½å¹»è§‰,æé«˜å¯ä¿¡åº¦
4. **æŠ€æœ¯ç¨³å¥**: Next.js 14 + Supabase + pgvector + æ™ºè°± AI æˆç†ŸæŠ€æœ¯æ ˆ

**é£é™©æ§åˆ¶**:
- P0 é£é™©åœ¨ Week 1-3 å®Œæˆ,ç¡®ä¿æ•°æ®å®‰å…¨ä¸ç”¨æˆ·ä½“éªŒ
- P1 é£é™©åœ¨ Week 4-5 å®Œæˆ,ä¼˜åŒ–äº¤äº’ä½“éªŒ
- P2 é£é™©åœ¨ Week 6 å®Œæˆ,æ€§èƒ½ä¸æˆæœ¬ä¼˜åŒ–

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. ç¬¬ 1 å‘¨: å®Œæˆé¡¹ç›®éª¨æ¶æ­å»ºä¸æ•°æ®æ¨¡å‹åŸºçº¿
2. æ¯å‘¨ Standup: æ£€æŸ¥ Checklist ä¸é£é™©ç¼“è§£è¿›åº¦
3. ç¬¬ 6 å‘¨: å®Œæˆ Demo å½•å±,å‡†å¤‡æ¼”ç¤º

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026å¹´1æœˆ25æ—¥  
**ç»´æŠ¤å›¢é˜Ÿ**: AI æŠ€æœ¯å›¢é˜Ÿ
