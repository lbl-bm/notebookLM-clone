# US-009: Prompt 模板库

## 用户故事
作为一个**Notebook 用户**，我希望能够**保存和复用常用的 Prompt 模板**，以便**快速生成定制化产物**。

## 验收标准

### 场景 1：查看模板库
- [ ] 当我在 Studio 面板点击"模板库"标签时，我应该看到：
  - 系统预设模板（如"生成摘要"、"提取关键词"）
  - 我保存的自定义模板
- [ ] 每个模板显示：
  - 模板名称
  - 简短描述
  - 使用次数（可选）

### 场景 2：使用模板
- [ ] 当我点击模板时，我应该看到：
  - 模板的完整 Prompt 内容
  - 变量占位符（如 `{{topic}}`、`{{format}}`）
  - "运行"按钮
- [ ] 如果模板包含变量，我应该看到输入框填写变量值
- [ ] 点击"运行"后，系统应该：
  - 替换变量占位符
  - 基于选中的 Sources 生成产物
  - 将产物保存到 Artifacts

### 场景 3：创建自定义模板
- [ ] 当我点击"新建模板"时，我应该看到表单：
  - 模板名称（必填）
  - 描述（可选）
  - Prompt 内容（必填，支持 Markdown）
  - 变量定义（如 `{{topic}}` 表示主题）
- [ ] 保存后，模板应该出现在"我的模板"列表

### 场景 4：编辑和删除模板
- [ ] 我可以编辑我创建的模板
- [ ] 我可以删除我创建的模板
- [ ] 系统预设模板不可编辑/删除，但可以"复制为自定义模板"

### 场景 5：模板示例
**系统预设模板 1：生成摘要**
```
请基于以下资料生成一份简洁的摘要（200-300 字）：

要求：
- 提取核心观点
- 保留关键数据
- 使用简洁语言

资料内容：
{{context}}
```

**系统预设模板 2：提取关键词**
```
请从以下资料中提取 10-15 个关键词，并按重要性排序：

资料内容：
{{context}}

输出格式：
1. 关键词 1 - 简短说明
2. 关键词 2 - 简短说明
...
```

### 场景 6：模板分享（二期功能）
- [ ] 一期不实现分享功能
- [ ] 预留数据结构：`isPublic: boolean`, `sharedBy: userId`

## 技术约束
- 模板保存到 `PromptTemplate` 表：
  ```typescript
  {
    id: string,
    ownerId: string,
    name: string,
    description?: string,
    template: string, // 包含 {{variable}} 占位符
    variables: string[], // ['topic', 'format']
    isSystem: boolean, // 系统预设 vs 用户自定义
    createdAt: Date
  }
  ```
- 变量替换使用简单字符串替换（一期不需要复杂模板引擎）
- 系统预设模板在数据库初始化时插入（seed data）

## API 端点
- `GET /api/templates` - 获取模板列表
- `POST /api/templates` - 创建模板
- `PATCH /api/templates/:id` - 编辑模板
- `DELETE /api/templates/:id` - 删除模板
- `POST /api/templates/:id/run` - 运行模板

## 依赖
- US-008 (Studio 动作)
- `PromptTemplate` 表已创建

## 优先级
🟡 P1 - Week 5

## 估算
5 Story Points (2.5天)

## 测试用例
1. 查看模板库 → 看到系统预设模板和我的模板
2. 使用"生成摘要"模板 → 填写变量，生成摘要产物
3. 创建自定义模板"提取论点" → 保存成功，出现在列表
4. 编辑自定义模板 → 修改保存成功
5. 删除自定义模板 → 从列表消失
6. 尝试删除系统模板 → 显示"系统模板不可删除"

## 架构风险关联
- 无直接关联
