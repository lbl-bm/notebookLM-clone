# é¡¹ç›®æ’æœŸï¼ˆæŒ‰å‘¨ï¼‰+ ä¸¤åå‰ç«¯å¹¶è¡Œåˆ†å·¥ + éªŒæ”¶æ ‡å‡†ï¼ˆä¸€æœŸ MVPï¼‰

> å‡è®¾ï¼š2 åå‰ç«¯ï¼ˆå…¨æ ˆï¼‰å¹¶è¡Œå¼€å‘ï¼›æ¯å‘¨ 5 ä¸ªå·¥ä½œæ—¥ï¼›ä»¥â€œå¯æ¼”ç¤ºã€å¯è·‘é€šé—­ç¯â€ä¸ºç¬¬ä¸€ç›®æ ‡ã€‚

## 0. å›¢é˜Ÿåˆ†å·¥åŸåˆ™ï¼ˆå‡å°‘äº’ç›¸ç­‰å¾…ï¼‰

- **å‰ç«¯ Aï¼ˆåäº§å“å£³/å¯¼å…¥é“¾è·¯ï¼‰**ï¼šNotebook ç®¡ç†ã€Sources å·¦æ ã€å¯¼å…¥ UIã€ä¸Šä¼ ä¸å¯¼å…¥çŠ¶æ€ã€åŸºç¡€å¸ƒå±€ä¸è·¯ç”±ã€‚
- **å‰ç«¯ Bï¼ˆå AI/RAG/Studioï¼‰**ï¼šChat ä¸­æ ã€æµå¼å¯¹è¯ã€RAG APIã€å¼•ç”¨ç»“æ„ã€Studio åŠ¨ä½œä¸äº§ç‰©ã€é“¾è·¯å¯è§†åŒ–é¢æ¿ã€‚
- **å…±åŒçº¦å®šï¼ˆç¬¬ 1 å‘¨å¿…é¡»å®Œæˆï¼‰**
  - æ•°æ®æ¨¡å‹å­—æ®µå‘½åä¸æ¥å£å¥‘çº¦ï¼ˆ`citations` JSON ç»“æ„ï¼‰
  - `notebook_id` / `owner_id` çš„éš”ç¦»ç­–ç•¥ï¼ˆPrisma ç›´è¿æ—¶å¿…é¡»åº”ç”¨å±‚æ ¡éªŒï¼‰
  - å‘é‡æ£€ç´¢ RPC åç§°ä¸å…¥å‚ï¼ˆ`match_document_chunks`ï¼‰

## 1. é‡Œç¨‹ç¢‘ä¸æ’æœŸï¼ˆå»ºè®® 6 å‘¨ï¼‰

### Week 1ï¼šé¡¹ç›®éª¨æ¶ + ç™»å½• + æ•°æ®æ¨¡å‹åŸºçº¿

- **ç›®æ ‡**ï¼šèƒ½ç™»å½•ã€èƒ½åˆ›å»º Notebookã€èƒ½è¿›å…¥ Notebook è¯¦æƒ…é¡µï¼ˆç©ºå£³ï¼‰ã€‚

**A è´Ÿè´£**
- Next.js 14.2.35 åˆå§‹åŒ–ã€åŸºç¡€å¸ƒå±€ï¼ˆé¦–é¡µ/Notebook/è®¾ç½®ï¼‰
- Supabase Auth ç™»å½•/é€€å‡ºï¼ˆApp Router + `@supabase/ssr` cookieï¼‰
- Notebook åˆ—è¡¨é¡µ + åˆ›å»º/åˆ é™¤/æœ€è¿‘æ‰“å¼€ UIï¼ˆå‡æ•°æ®å¯å…ˆå ä½ï¼‰
- **ğŸ”´ æ¶æ„é£é™©ï¼š** æ­å»ºé”™è¯¯å¤„ç†è§„èŒƒï¼ˆç»Ÿä¸€é”™è¯¯ç ã€Toast å±•ç¤ºï¼‰

**B è´Ÿè´£**
- Prisma åˆå§‹åŒ–ï¼ˆschemaã€migrate æµç¨‹ï¼‰
- Supabase + Prisma è¿æ¥é…ç½®ï¼ˆ`DATABASE_URL` pooler + `DIRECT_URL` ç›´è¿ï¼‰
- `/api/chat` ç©ºå®ç°ï¼ˆå›æ˜¾ï¼‰+ `useChat` åŸºç¡€ UIï¼ˆç©ºå¼•ç”¨ç»“æ„ï¼‰
- **ğŸ”´ æ¶æ„é£é™© 8.1ï¼š** å®ç°å‘é‡ç»´åº¦ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆå¯åŠ¨æ—¶æ–­è¨€ `EMBEDDING_DIM`ï¼‰
- **ğŸ”´ æ¶æ„é£é™© 8.5ï¼š** é…ç½® Supabase Storage bucket + RLS ç­–ç•¥

**éªŒæ”¶æ ‡å‡†**
- æ–°ç”¨æˆ·ç™»å½•åå¯åˆ›å»º Notebook å¹¶è¿›å…¥è¯¦æƒ…é¡µ
- èƒ½å‘é€æ¶ˆæ¯çœ‹åˆ°æµå¼è¿”å›ï¼ˆå“ªæ€•æ˜¯ mockï¼‰
- ç¯å¢ƒå˜é‡ `EMBEDDING_DIM` ä¸ä»£ç ä¸­çš„å¸¸é‡ä¸€è‡´ï¼Œå¦åˆ™å¯åŠ¨å¤±è´¥

---

### Week 2ï¼šSource ç®¡ç† + ä¸Šä¼ /é“¾æ¥å…¥åº“ + ä»»åŠ¡çŠ¶æ€

- **ç›®æ ‡**ï¼šå·¦ä¾§ Sources èƒ½æ–°å¢ç´ æå¹¶æ˜¾ç¤ºå¤„ç†çŠ¶æ€ã€‚

**A è´Ÿè´£**
- Sources å·¦æ  UIï¼šåˆ—è¡¨ã€å‹¾é€‰å¯¼å…¥ã€çŠ¶æ€ badgeï¼ˆpending/processing/ready/failedï¼‰
- ä¸Šä¼ å…¥å£ï¼ˆPDF å¿…åšï¼‰ï¼šå‰ç«¯ä¸Šä¼ åˆ° Supabase Storage
- å½•å…¥ URL Sourceï¼ˆç½‘é¡µé“¾æ¥ï¼‰

**B è´Ÿè´£**
- `/api/sources/upload`ï¼šåˆ›å»º Source è®°å½•ï¼ˆè¿”å› sourceIdï¼‰
- `/api/sources/url`ï¼šåˆ›å»º URL Source
- `/api/sources/:id`ï¼šæŸ¥è¯¢çŠ¶æ€ä¸ meta
- ä»»åŠ¡çŠ¶æ€è½®è¯¢ï¼ˆæˆ– SSEï¼‰æ–¹æ¡ˆå®šç¨¿

**éªŒæ”¶æ ‡å‡†**
- ä¸Šä¼ /é“¾æ¥åï¼ŒSource åˆ—è¡¨å¯è§å¹¶å±•ç¤ºçŠ¶æ€
- Notebook å†…å¯å‹¾é€‰â€œå‚ä¸å›ç­”çš„èµ„æ–™èŒƒå›´â€

---

### Week 3ï¼šè§£æ + Chunk + å‘é‡åŒ– + pgvector æ£€ç´¢è·‘é€š

- **ç›®æ ‡**ï¼šå®Œæˆæœ€å° RAG ç´¢å¼•é“¾è·¯ï¼šPDF â†’ text â†’ chunks â†’ embeddings â†’ pgvector â†’ RPC æ£€ç´¢ã€‚

**A è´Ÿè´£**
- å¯¼å…¥è¿›åº¦ UIï¼ˆè§£æä¸­/å‘é‡åŒ–ä¸­/å®Œæˆï¼‰
- Source è¯¦æƒ…æŠ½å±‰/å¼¹å±‚ï¼šå±•ç¤ºåŸºç¡€æ‘˜è¦ï¼ˆå¯å…ˆæ˜¾ç¤ºå‰ N å­—ï¼‰

**B è´Ÿè´£**
- SQL è¿ç§»ï¼š`vector` æ‰©å±•ã€`document_chunks` è¡¨ã€HNSW ç´¢å¼•ã€`match_document_chunks` RPC
- `/api/sources/:id/ingest`ï¼šè§¦å‘è§£æä¸å‘é‡åŒ–ï¼ˆä¸€æœŸå…è®¸åŒæ­¥/åŠåŒæ­¥ï¼‰
- é€‰å‹å¹¶æ¥å…¥ Embedding æ¨¡å‹ï¼š**æ™ºè°± Embedding-3ï¼ˆå»ºè®®ä» 1024 ç»´å¼€å§‹ï¼›â‰¤ 2000 ä»¥æ”¯æŒç´¢å¼•ï¼‰**

**éªŒæ”¶æ ‡å‡†**
- ç»™å®š queryï¼Œå¯ä» RPC è¿”å› topK chunksï¼ˆå« similarityï¼‰
- Source çŠ¶æ€å¯ä» processing å˜ä¸º ready

---

### Week 4ï¼šRAG é—®ç­” + å¼•æ–‡é«˜äº®ï¼ˆæ ¸å¿ƒä½“éªŒæˆå‹ï¼‰

- **ç›®æ ‡**ï¼šNotebook å†…å®ç°â€œåŸºäºçŸ¥è¯†åº“å›ç­” + å¼•æ–‡é«˜äº® + æ‰¾ä¸åˆ°ä¾æ®æ‹’ç­”â€ã€‚

**A è´Ÿè´£**
- å¼•ç”¨ UIï¼ˆå³ä¾§/æ¶ˆæ¯ä¸‹æ–¹å¼•ç”¨å¡ç‰‡ï¼‰ï¼šç‚¹å‡»å®šä½åˆ° chunk æ–‡æœ¬
- æºæ–‡æ¡£é¢„è§ˆï¼ˆMVPï¼šå±•ç¤º chunk åˆ—è¡¨å³å¯ï¼›äºŒæœŸå†åšé¡µçº§å®šä½ï¼‰

**B è´Ÿè´£**
- `/api/chat`ï¼šRAG æ£€ç´¢ + ç»„è£… prompt + **è°ƒç”¨ GLM-4.7 æµå¼ç”Ÿæˆ**
- citations ç»“æ„è½åœ°ï¼šæŠŠæ£€ç´¢åˆ°çš„ chunk æ˜ å°„ä¸º citations è¿”å›
- â€œæ— ä¾æ®ç­–ç•¥â€ï¼šå½“æ£€ç´¢åˆ†æ•°ä½äºé˜ˆå€¼æ—¶ï¼Œè¿”å› `answerMode=no_evidence`

**éªŒæ”¶æ ‡å‡†**
- AI å›å¤å¿…é¡»å¸¦ citationsï¼›å¼•ç”¨å¯ç‚¹å‡»å¹¶æ˜¾ç¤ºåŸæ–‡ç‰‡æ®µ
- æ— ä¾æ®æ—¶ä¸èƒ¡ç¼–ï¼Œæç¤ºè¡¥å……èµ„æ–™/ç¼©å°é—®é¢˜

---

### Week 5ï¼šStudio åŠ¨ä½œ + Prompt æ¨¡æ¿åº“ + äº§ç‰©ç®¡ç†

- **ç›®æ ‡**ï¼šå³ä¾§ Studio è‡³å°‘ 2 ä¸ªåŠ¨ä½œå¯ç”Ÿæˆäº§ç‰©ï¼Œå¹¶å¯å›çœ‹/å¤åˆ¶ã€‚

**A è´Ÿè´£**
- Studio UIï¼šåŠ¨ä½œæŒ‰é’®åŒºã€æ¨¡æ¿åº“åˆ—è¡¨ã€äº§ç‰©åˆ—è¡¨ï¼ˆArtifactsï¼‰
- äº§ç‰©æ¸²æŸ“ï¼ˆMarkdown/JSONï¼‰+ å¤åˆ¶/ä¸‹è½½ï¼ˆMVPï¼‰

**B è´Ÿè´£**
- `/api/actions/*`ï¼šåŸºäº **GLM-4.7** å®ç°åŠ¨ä½œï¼ˆæ€ç»´å¯¼å›¾/å¤§çº²/æµ‹éªŒ è‡³å°‘ 2 ä¸ªï¼‰
- PromptTemplate CRUDï¼ˆä¿å­˜/ç¼–è¾‘/åˆ é™¤ï¼‰
- Artifact è½åº“ï¼ˆPrismaï¼‰

**éªŒæ”¶æ ‡å‡†**
- è‡³å°‘ 2 ç§äº§ç‰©å¯ä¸€é”®ç”Ÿæˆå¹¶ä¿å­˜
- æ¨¡æ¿å¯å¤ç”¨ï¼Œè¿è¡Œæ—¶å¯é€‰æ‹© Sources èŒƒå›´

---

### Week 6ï¼šå·®å¼‚åŒ–äº®ç‚¹æ”¶å£ + Demo æ‰“ç£¨

- **ç›®æ ‡**ï¼šåšå‡ºâ€œå¯å±•ç¤ºä¼˜åŠ¿â€çš„æ¼”ç¤ºç‰ˆæœ¬ï¼šRAG é“¾è·¯å¯è§†åŒ– Lite + ä½“éªŒæ‰“ç£¨ã€‚

**A è´Ÿè´£**
- UI/UX æ‰“ç£¨ï¼šç©ºçŠ¶æ€ã€åŠ è½½æ€ã€é”™è¯¯æ€ã€å¿«æ·å…¥å£ã€é”®ç›˜ä½“éªŒ
- é¦–é¡µç²¾é€‰/æœ€è¿‘æ‰“å¼€å®Œå–„

**B è´Ÿè´£**
- RAG é“¾è·¯å¯è§†åŒ– Liteï¼šå±•ç¤º topK chunksï¼ˆåˆ†æ•°/æ¥æº/ç‰‡æ®µï¼‰
- æ€§èƒ½ä¸æˆæœ¬ï¼šç¼“å­˜ embeddingã€topKã€è¯·æ±‚å»é‡

**éªŒæ”¶æ ‡å‡†**
- Demo æµç¨‹å¯é¡ºç•…æ¼”ç¤ºï¼šå¯¼å…¥ â†’ é—®ç­” â†’ å¼•ç”¨ â†’ åŠ¨ä½œäº§ç‰© â†’ é“¾è·¯è§£é‡Š

## 2. å…³é”®éœ€æ±‚æè¿°ï¼ˆè½åˆ°å¯éªŒæ”¶çš„â€œæ¸…å•â€ï¼‰

### 2.1 é¦–é¡µï¼ˆNotebook åˆ—è¡¨ï¼‰
- æ–°å»º/åˆ é™¤/é‡å‘½å
- ç²¾é€‰/æœ€è¿‘æ‰“å¼€
- æœç´¢ï¼ˆå¯é€‰ï¼‰

### 2.2 Notebook è¯¦æƒ…ä¸‰æ 
- å·¦ï¼šSourcesï¼ˆå¯¼å…¥ã€å‹¾é€‰èŒƒå›´ã€çŠ¶æ€ï¼‰
- ä¸­ï¼šChatï¼ˆæµå¼ã€å»ºè®®é—®é¢˜ã€Markdown/ä»£ç /Mermaidã€å¼•ç”¨é«˜äº®ï¼‰
- å³ï¼šStudioï¼ˆåŠ¨ä½œã€æ¨¡æ¿ã€äº§ç‰©ï¼‰

### 2.3 å®‰å…¨ä¸éš”ç¦»ï¼ˆä¸€æœŸåº•çº¿ï¼‰
- æ¯ä¸ª Notebook å¿…é¡»ç»‘å®š ownerId
- æ‰€æœ‰ API å¿…é¡»æ ¡éªŒ ownerId
- å¼•æ–‡å¿…é¡»æ¥è‡ªå½“å‰ Notebook çš„ chunks




## 3. æ¶æ„é£é™©è¿½è¸ªæ¸…å•ï¼ˆå¿…é¡»åœ¨å¯¹åº”å‘¨å®Œæˆï¼‰

> å‚è€ƒ PROJECT_SPEC.md ç¬¬ 8 ç« çš„è¯¦ç»†è§£å†³æ–¹æ¡ˆ

### ğŸ”´ P0 - å¿…é¡»å®ç°ï¼ˆæ•°æ®å®‰å…¨/ç”¨æˆ·ä½“éªŒå…³é”®ï¼‰

| é£é™©ç¼–å· | é£é™©åç§° | è´Ÿè´£äºº | è®¡åˆ’å‘¨ | éªŒæ”¶æ ‡å‡† |
|---|---|---|---|---|
| 8.1 | å‘é‡ç»´åº¦ä¸€è‡´æ€§ | B | Week 1 | å¯åŠ¨æ—¶æ£€æŸ¥ `EMBEDDING_DIM`ï¼Œä¸ä¸€è‡´åˆ™æŠ›é”™ |
| 8.2 | æ–‡ä»¶è§£æé”™è¯¯æ¢å¤ | B | Week 2-3 | Source è¡¨åŒ…å« `processingLog`ã€`retryCount`ï¼›å¤±è´¥å¯é‡è¯• |
| 8.5 | Storage æ–‡ä»¶ç®¡ç† | A+B | Week 1-2 | RLS ç­–ç•¥ç”Ÿæ•ˆï¼›åˆ é™¤ Source çº§è”åˆ é™¤æ–‡ä»¶ |

### ğŸŸ¡ P1 - å¼ºçƒˆå»ºè®®ï¼ˆç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼‰

| é£é™©ç¼–å· | é£é™©åç§° | è´Ÿè´£äºº | è®¡åˆ’å‘¨ | éªŒæ”¶æ ‡å‡† |
|---|---|---|---|---|
| 8.3 | Citations å»é‡ | B | Week 4 | ç›¸åŒå†…å®¹çš„ chunk å¤ç”¨ embeddingï¼›æ£€ç´¢ç»“æœå»é‡ |
| 8.4 | æµå¼ Citations æ—¶åº | B | Week 4 | æµå¼è¾“å‡ºå®Œæˆåè¿½åŠ  citationsï¼›å‰ç«¯æ­£ç¡®è§£æ |

### ğŸŸ¢ P2 - å¯é€‰ï¼ˆæ€§èƒ½/æˆæœ¬ä¼˜åŒ–ï¼‰

| é£é™©ç¼–å· | é£é™©åç§° | è´Ÿè´£äºº | è®¡åˆ’å‘¨ | éªŒæ”¶æ ‡å‡† |
|---|---|---|---|---|
| 8.6 | é¢„å¤„ç†é˜Ÿåˆ— | B | Week 3 | åˆ›å»º `processing_queue` è¡¨ï¼›ä¸Šä¼ ç«‹å³è¿”å› |
| 8.7 | æ··åˆæ£€ç´¢ | B | Week 6 | å®ç° `hybrid_search` RPCï¼ˆå¯é€‰ï¼‰ |
| 8.8 | Embedding ç¼“å­˜ | B | Week 6 | Query embedding ç¼“å­˜å‘½ä¸­ç‡ > 30% |

---

## 4. æ¯å‘¨ Standup æ£€æŸ¥é¡¹ï¼ˆé˜²æ­¢é—æ¼ï¼‰

### Week 1 Checklist
- [ ] ç¯å¢ƒå˜é‡ `EMBEDDING_DIM=1024` å·²é…ç½®
- [ ] ä»£ç ä¸­æœ‰å¯åŠ¨æ–­è¨€æ£€æŸ¥ç»´åº¦ä¸€è‡´æ€§
- [ ] Supabase Storage bucket `notebook-sources` å·²åˆ›å»º
- [ ] RLS ç­–ç•¥å·²é…ç½®ï¼ˆç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ–‡ä»¶ï¼‰
- [ ] é”™è¯¯å¤„ç†è§„èŒƒæ–‡æ¡£å·²è¾“å‡ºï¼ˆé”™è¯¯ç ã€Toast æ ·å¼ï¼‰

### Week 2 Checklist
- [ ] Source è¡¨åŒ…å« `processingLog`ã€`lastProcessedChunkIndex`ã€`retryCount`ã€`errorMessage`
- [ ] `processing_queue` è¡¨å·²åˆ›å»º
- [ ] ä¸Šä¼ æ–‡ä»¶è·¯å¾„éµå¾ª `{ownerId}/{notebookId}/{sourceId}_{timestamp}.ext`
- [ ] å‰ç«¯è½®è¯¢ `/api/sources/:id` å¯çœ‹åˆ° `processingLog` æ›´æ–°

### Week 3 Checklist
- [ ] `document_chunks` è¡¨åŒ…å« `content_hash`ã€`embedding_model`ã€`embedding_dim`
- [ ] HNSW ç´¢å¼•å·²åˆ›å»ºï¼ˆ`vector_cosine_ops`ï¼‰
- [ ] è°ƒç”¨ Embedding API æ—¶å¼ºåˆ¶æŒ‡å®š `dimensions: 1024`
- [ ] å®ç°æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ429/5xx é”™è¯¯ï¼‰
- [ ] è§£æå¤±è´¥æ—¶æ›´æ–° `processingLog.stages.parse.error`

### Week 4 Checklist
- [ ] Citations ç»“æ„åŒ…å« `chunkId`ã€`sourceId`ã€`score`ã€`locator`ã€`excerpt`
- [ ] æµå¼è¾“å‡ºåœ¨æ–‡æœ¬ç»“æŸåè¿½åŠ  `__CITATIONS__` åˆ†éš”ç¬¦
- [ ] å‰ç«¯ `onFinish` å›è°ƒæ­£ç¡®è§£æ citations
- [ ] ç›¸åŒ `content_hash` çš„ chunk å¤ç”¨ embedding
- [ ] æ£€ç´¢ç»“æœæŒ‰ `content_hash` å»é‡

### Week 5 Checklist
- [ ] è‡³å°‘ 2 ä¸ª Studio åŠ¨ä½œå¯ç”Ÿæˆäº§ç‰©
- [ ] Artifact è¡¨åŒ…å« `type`ã€`input`ã€`content`
- [ ] PromptTemplate CRUD API å·²å®ç°

### Week 6 Checklist
- [ ] RAG é“¾è·¯å¯è§†åŒ–é¢æ¿å±•ç¤º topK chunks
- [ ] Query embedding ç¼“å­˜å·²å®ç°ï¼ˆVercel KV æˆ–å†…å­˜ï¼‰
- [ ] åˆ é™¤ Source æ—¶çº§è”åˆ é™¤æ–‡ä»¶å’Œ chunks
- [ ] Demo æµç¨‹å¯å®Œæ•´æ¼”ç¤ºï¼ˆå½•å±å¤‡ç”¨ï¼‰

---

## 5. æŠ€æœ¯å€ºåŠ¡ç™»è®°ï¼ˆäºŒæœŸä¼˜åŒ–ï¼‰

| å€ºåŠ¡é¡¹ | å½“å‰æ–¹æ¡ˆ | ç†æƒ³æ–¹æ¡ˆ | ä¼˜å…ˆçº§ | é¢„ä¼°å·¥ä½œé‡ |
|---|---|---|---|---|
| æ— åˆ†å¸ƒå¼é” | å¹¶å‘å¯¼å…¥åŒä¸€æ–‡ä»¶å¯èƒ½é‡å¤ | Redis åˆ†å¸ƒå¼é” | P2 | 1å¤© |
| åŒæ­¥å¤„ç†å¤§æ–‡ä»¶ | API å¯èƒ½è¶…æ—¶ | çœŸæ­£çš„å¼‚æ­¥é˜Ÿåˆ—ï¼ˆBullMQï¼‰ | P1 | 3å¤© |
| çº¯å‘é‡æ£€ç´¢ | å¯èƒ½æ¼æ‰å…³é”®è¯ | æ··åˆæ£€ç´¢ï¼ˆå·²åœ¨ 8.7 æä¾›æ–¹æ¡ˆï¼‰ | P1 | 3å¤© |
| æ— ç›‘æ§å‘Šè­¦ | ä¾èµ–æ—¥å¿—æ’æŸ¥ | Sentry + è‡ªå®šä¹‰ Dashboard | P2 | 2å¤© |
| Chunk å›ºå®šå¤§å° | å¯èƒ½åˆ‡æ–­è¯­ä¹‰ | è¯­ä¹‰åˆ‡åˆ†ï¼ˆLangChain RecursiveCharacterTextSplitterï¼‰ | P3 | 2å¤© |
