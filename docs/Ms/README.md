# RAG 全链路优化里程碑文档集（Ms）

## 文档目标

本目录用于沉淀“从上传知识源后到答案生成”的全链路优化执行文档。每个里程碑文档都遵循同一结构，便于按阶段推进、评估和回滚。

## 里程碑文档

- [M1 - 证据约束与可观测底座](./M1-证据约束与可观测底座.md)
- [M2 - 多路召回与精排增强](./M2-多路召回与精排增强.md)
- [M3 - 事实校验与评测治理闭环](./M3-事实校验与评测治理闭环.md)

## 当前执行策略（2026-02）

- 当前阶段优先执行 M1、M2，目标是以有限人力完成可上线且可回滚的核心能力。
- M3（事实校验与评测治理闭环）暂缓执行，待人力与基础设施成熟后再启动。
- M2 中高成本项（重度 Query Rewrite、默认开启 stage2 精排）按灰度收益决定是否投入。

## 统一执行原则

1. **先可观测后优化**：任何优化都必须有前后指标对比。
2. **先收敛风险再提峰值**：优先减少幻觉、误答、乱答，再追求更高覆盖率。
3. **灰度上线**：每个里程碑必须支持按 notebook / 用户分组灰度。
4. **可回滚**：每项核心改造必须定义降级路径与一键回退条件。
5. **跨领域通用**：避免绑定单一行业关键词，不依赖领域特定模板。

## 文档阅读顺序

1. 先阅读 M1，完成证据约束和指标底座。
2. 再执行 M2，升级检索召回与重排。
3. M3 当前为暂缓项，仅作为后续规划参考。

## 交付物清单（总览）

- 架构层：链路分层、模块职责、数据流与控制流
- 工程层：模块文件改造清单、配置与开关、灰度策略
- 质量层：验收标准、SLO/SLA、回归测试与基准集
- 运维层：监控告警、故障排查、回滚预案

## 与现有项目模块映射（参考）

- 解析/切分/向量化：`lib/processing/*`
- 向量存储与检索 SQL：`lib/db/vector-store.ts`
- RAG 检索与 Prompt 组装：`lib/rag/*`
- 聊天生成入口：`app/api/chat/route.ts`
- Studio 生成链路：`lib/studio/*`
- 配置：`lib/config.ts`
- 数据模型与迁移：`prisma/schema.prisma`, `prisma/migrations/*`

## 版本管理建议

- 文档版本号格式：`vX.Y.Z`
- 每个里程碑发布后，新增“实施复盘”章节：记录偏差、收益与后续动作。
